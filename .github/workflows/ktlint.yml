name: KtLint Check
# I already have KtLint in a project built in Gradle, This is for practice and just in case
on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
    
jobs:
  ktlint:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: gradle
    - name: Download KtLint
      run: |
          curl -sSLO https://github.com/pinterest/ktlint/releases/download/<VERSION>/ktlint
          chmod a+x ktlint

    - name: Run KtLint
      run: ./ktlint --reporter=checkstyle --color src/**/*.kt > ktlint.xml || true

    - name: Upload KtLint report
      uses: actions/upload-artifact@v2
      with:
          name: ktlint-report
          path: ktlint.xml

    - name: Reviewdog
      uses: reviewdog/action-setup@v1
      with:
          reviewdog_version: latest

    - name: Analyze KtLint report
      run: cat ktlint.xml | reviewdog -f=checkstyle -name="KtLint" -reporter=github-pr-review -level=warning
      env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.REVIEWDOG_TOKEN }}

